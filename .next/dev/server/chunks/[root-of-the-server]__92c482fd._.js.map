{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/ermuhan/Developer/NextJs/ai-course-generation/app/api/generate-roadmap/route.ts"],"sourcesContent":["// app/api/generate-roadmap/route.ts\nimport Groq from \"groq-sdk\";\n\nconst groq = new Groq({ apiKey: process.env.GROQ_API_KEY });\n\nexport async function POST(request: Request) {\n  try {\n    const { course, userProfile } = await request.json();\n\n    // üîç Debug: Log the received data\n    console.log(\"=== GENERATE ROADMAP REQUEST ===\");\n    console.log(\"Target Language:\", course.targetLanguage);\n    console.log(\"Level:\", course.level);\n    console.log(\"Daily Time:\", course.dailyTime);\n\n    const profile = userProfile ?? {\n      fullName: \"Unknown\",\n      profession: \"Unknown\",\n      field: \"Unknown\",\n      interests: [],\n    };\n\n    const userInterests = Array.isArray(profile.interests)\n      ? profile.interests\n      : [];\n    const courseInterests = Array.isArray(course.interests)\n      ? course.interests\n      : [];\n\n    const moduleCount = getModuleCount(course.level, course.dailyTime);\n    const topicsPerModule = getTopicsPerModule(course.dailyTime);\n\n    const targetLanguage = course.targetLanguage;\n\n    // üîç Debug: Confirm target language\n    console.log(\"üéØ Generating content in:\", targetLanguage);\n\n    const prompt = `You are a professional ${targetLanguage} language teacher. Create a comprehensive learning roadmap.\n\nUSER INFORMATION:\n- Name: ${profile.fullName}\n- Profession: ${profile.profession}\n- Interests: ${userInterests.length > 0 ? userInterests.join(\", \") : \"General\"}\n\nCOURSE DETAILS:\n- Target Language: ${targetLanguage}\n- Level: ${course.level}\n- Daily Study Time: ${course.dailyTime} minutes\n- Interests: ${\n      courseInterests.length > 0 ? courseInterests.join(\", \") : \"General\"\n    }\n\nREQUIREMENTS:\n- Create ${moduleCount} modules\n- Each module should have ${topicsPerModule} topics\n- Difficulty level: ${course.level}\n- Progressive difficulty increase\n\n‚ö†Ô∏è CRITICAL INSTRUCTION - READ CAREFULLY:\nThe student wants to LEARN ${targetLanguage}.\nTherefore, you MUST write ALL content in ${targetLanguage} language:\n- Module titles ‚Üí in ${targetLanguage}\n- Module descriptions ‚Üí in ${targetLanguage}\n- Topic titles ‚Üí in ${targetLanguage}\n- Topic descriptions ‚Üí in ${targetLanguage}\n\nDO NOT write in English, Uzbek, Russian, or any other language.\nONLY use ${targetLanguage} language.\n\nEXAMPLES based on target language:\n${getLanguageExamples(targetLanguage)}\n\nReturn ONLY valid JSON in this exact format:\n\n{\n  \"modules\": [\n    {\n      \"title\": \"Module name in ${targetLanguage}\",\n      \"description\": \"Short description in ${targetLanguage}\",\n      \"topics\": [\n        {\n          \"title\": \"Topic name in ${targetLanguage}\",\n          \"description\": \"Topic description in ${targetLanguage}\"\n        }\n      ]\n    }\n  ]\n}`;\n\n    console.log(\"üìù Sending prompt to Groq...\");\n\n    const response = await groq.chat.completions.create({\n      model: \"llama-3.1-8b-instant\",\n      messages: [\n        {\n          role: \"system\",\n          content: `\n            You are a professional ${targetLanguage} language teacher.\n            ALL content (module titles, descriptions, topic titles, topic descriptions, examples, tasks) MUST be in ${targetLanguage}.\n            Do NOT use English, Uzbek, Russian, or any other language.\n            Respond ONLY in VALID JSON format.\n            `,\n        },\n        { role: \"user\", content: prompt },\n      ],\n      temperature: 0.6,\n      max_tokens: 4000,\n    });\n\n    const text = response.choices[0]?.message?.content ?? \"\";\n\n    // üîç Debug: Log raw AI response\n    console.log(\n      \"ü§ñ AI Raw Response (first 500 chars):\",\n      text.substring(0, 500)\n    );\n\n    let roadmap;\n    try {\n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n      if (jsonMatch) {\n        roadmap = JSON.parse(jsonMatch[0]);\n      } else {\n        roadmap = JSON.parse(text);\n      }\n    } catch (err) {\n      console.error(\"‚ùå JSON parse error:\", err);\n      console.error(\"Full AI Response:\", text);\n      roadmap = { modules: [] };\n    }\n\n    if (!roadmap.modules || !Array.isArray(roadmap.modules)) {\n      console.error(\"‚ùå Invalid roadmap structure:\", roadmap);\n      roadmap = { modules: [] };\n    }\n\n    // üîç Debug: Log generated content sample\n    if (roadmap.modules.length > 0) {\n      console.log(\"‚úÖ Generated modules count:\", roadmap.modules.length);\n      console.log(\"‚úÖ First module title:\", roadmap.modules[0].title);\n      console.log(\n        \"‚úÖ First topic title:\",\n        roadmap.modules[0].topics?.[0]?.title\n      );\n    }\n\n    return new Response(JSON.stringify(roadmap), {\n      headers: { \"Content-Type\": \"application/json\" },\n    });\n  } catch (error) {\n    console.error(\"‚ùå Fatal error in generate-roadmap:\", error);\n    return new Response(\n      JSON.stringify({\n        error: \"Failed to generate roadmap\",\n        details: error instanceof Error ? error.message : \"Unknown error\",\n      }),\n      { status: 500, headers: { \"Content-Type\": \"application/json\" } }\n    );\n  }\n}\n\nfunction getLanguageExamples(language: string): string {\n  const lower = language.toLowerCase();\n\n  if (lower.includes(\"english\") || lower.includes(\"ingliz\")) {\n    return `If target is English:\n- Module: \"Basic Grammar and Vocabulary\"\n- Topic: \"Present Simple Tense\"\n- Description: \"Learn how to form and use the present simple tense\"`;\n  }\n\n  if (lower.includes(\"spanish\") || lower.includes(\"ispan\")) {\n    return `Si el objetivo es espa√±ol:\n- M√≥dulo: \"Gram√°tica y Vocabulario B√°sico\"\n- Tema: \"Presente Simple\"\n- Descripci√≥n: \"Aprende a formar y usar el presente simple\"`;\n  }\n\n  if (lower.includes(\"french\") || lower.includes(\"fransuz\")) {\n    return `Si la cible est le fran√ßais:\n- Module: \"Grammaire et Vocabulaire de Base\"\n- Sujet: \"Pr√©sent Simple\"\n- Description: \"Apprendre √† former et utiliser le pr√©sent simple\"`;\n  }\n\n  if (lower.includes(\"german\") || lower.includes(\"nemis\")) {\n    return `Wenn Ziel Deutsch ist:\n- Modul: \"Grundlegende Grammatik und Wortschatz\"\n- Thema: \"Pr√§sens\"\n- Beschreibung: \"Lernen Sie, das Pr√§sens zu bilden und zu verwenden\"`;\n  }\n\n  if (lower.includes(\"russian\") || lower.includes(\"rus\")) {\n    return `–ï—Å–ª–∏ —Ü–µ–ª—å —Ä—É—Å—Å–∫–∏–π:\n- –ú–æ–¥—É–ª—å: \"–ë–∞–∑–æ–≤–∞—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ –∏ —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å\"\n- –¢–µ–º–∞: \"–ù–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è\"\n- –û–ø–∏—Å–∞–Ω–∏–µ: \"–ù–∞—É—á–∏—Ç–µ—Å—å –æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è\"`;\n  }\n\n  return `For ${language}:\n- Write module titles in ${language}\n- Write topic titles in ${language}\n- Write all descriptions in ${language}`;\n}\n\nfunction getModuleCount(level: string, dailyTime: number): number {\n  const baseModules: Record<string, number> = {\n    A1: 4,\n    A2: 5,\n    B1: 6,\n    B2: 6,\n    C1: 5,\n    C2: 4,\n  };\n  const base = baseModules[level] || 5;\n  if (dailyTime >= 120) return Math.min(base + 2, 8);\n  if (dailyTime >= 60) return base + 1;\n  if (dailyTime <= 30) return Math.max(base - 1, 3);\n  return base;\n}\n\nfunction getTopicsPerModule(dailyTime: number): number {\n  if (dailyTime >= 120) return 7;\n  if (dailyTime >= 60) return 6;\n  if (dailyTime >= 45) return 5;\n  return 4;\n}\n"],"names":[],"mappings":"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"}}]
}